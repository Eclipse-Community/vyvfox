/* Color overrides */

@media (-moz-bool-pref: "r3dfox.colors.enabled") {
  :root {
    --arrowpanel-border-color: light-dark(rgb(255, 60, 60), rgb(160, 60, 60)) !important;
    --toolbar-field-focus-border-color: light-dark(rgb(255, 40, 40), rgb(160, 60, 60)) !important;
    --sidebar-border-color: light-dark(rgb(255, 60, 60), rgb(160, 60, 60)) !important;
    --lwt-toolbar-field-highlight: light-dark(rgb(255, 40, 40), rgb(160, 60, 60)) !important;
    --newtab-primary-action-background: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --newtab-primary-action-background-hover: light-dark(rgb(255, 40, 40), rgb(255, 60, 60)) !important;
    --newtab-primary-action-background-active: light-dark(rgb(255, 40, 40), rgb(255, 40, 40)) !important;
    --in-content-primary-button-background: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --in-content-primary-button-background-hover: light-dark(rgb(255, 40, 40), rgb(255, 60, 60)) !important;
    --in-content-primary-button-background-active: light-dark(rgb(255, 40, 40), rgb(255, 40, 40)) !important;
    --color-accent-primary: light-dark(rgb(255, 20, 20), rgb(255, 100, 100)) !important;
    --color-accent-primary-hover: light-dark(rgb(255, 60, 60), rgb(255, 80, 80)) !important;
    --color-accent-primary-active: light-dark(rgb(255, 60, 60), rgb(255, 60, 60)) !important;
    --link-color: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --link-color-hover: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --link-color-active: light-dark(rgb(255, 60, 60), rgb(255, 60, 60)) !important;
    --link-color-visited: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --button-primary-bgcolor: light-dark(rgb(255, 20, 20), rgb(255, 100, 100)) !important;
    --button-primary-hover-bgcolor: light-dark(rgb(255, 60, 60), rgb(255, 80, 80)) !important;
    --button-primary-active-bgcolor: light-dark(rgb(255, 60, 60), rgb(255, 60, 60)) !important;
    --toolbarbutton-icon-fill-attention: light-dark(rgb(255, 20, 20), rgb(255, 80, 80)) !important;
    --download-progress-fill-color: light-dark(rgb(255, 40, 40), rgb(255, 80, 80)) !important;
    --lwt-tab-line-color: light-dark(rgb(255, 40, 40), rgb(255, 80, 80)) !important;
    &[privatebrowsingmode=temporary] {
        --tabpanel-background-color: linear-gradient(to bottom, #480808 0%,#240103 93%,#200000 97%,#1E0000 100%) !important;
    }

    ::selection {
      background: light-dark(rgb(255, 80, 80), rgb(160, 60, 60)) !important;
    }

    .bookmark-item:is(toolbarbutton)[dragover="true"][open="true"] {
      background: light-dark(rgb(255, 80, 80), rgb(160, 60, 60)) !important;
    }

    .tab-drop-indicator {
      background: url(chrome://browser/skin/tabbrowser/r3d-tab-drag-indicator.svg) no-repeat center !important;
    }

    #PlacesToolbarDropIndicator {
      list-style-image: url(chrome://browser/skin/r3d-toolbar-drag-indicator.svg) !important;
    }
  }

  html.private {
      --in-content-page-background: linear-gradient(to bottom, #480808 0%,#240103 93%,#200000 97%,#1E0000 100%) !important;
  }

  #main-window[privatebrowsingmode="temporary"] #TabsToolbar {
    background-color: #CC190032 !important;
  }
}

/* Aero fog and other settings */

@media (-moz-windows-default-theme), (-moz-windows-compositor) {
  #main-menubar:not([lwtheme]) {
    color: black;
  }
}

@media (-moz-bool-pref: "r3dfox.aero.fog") {
  @media (-moz-platform: windows-win7), (-moz-platform: windows-win8) {
    @media (-moz-windows-default-theme), (-moz-windows-compositor) {
      #navigator-toolbox:not([lwtheme]) {
        background-color: transparent !important;
      }
      #titlebar:not([lwtheme]) {
        appearance: inherit !important;
        @media (-moz-bool-pref: "r3dfox.less.aero.fog") {
          background-image: radial-gradient(ellipse at bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.5) 40%, transparent) !important;
        }
        @media not (-moz-bool-pref: "r3dfox.less.aero.fog") {
          background-image: radial-gradient(ellipse at bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.5) 80%, transparent) !important;
        }
      }
      :root[sizemode=maximized] {
        #titlebar:not([lwtheme]) {
          margin-top: 8px !important;
        }
      }
    }
  }
}

@media (-moz-bool-pref: "r3dfox.aero.fog") {
  @media (-moz-windows-classic) {
    :root[tabsintitlebar]:not([sizemode=fullscreen]) #TabsToolbar {
      background-image: linear-gradient(transparent, ActiveCaption) !important;
      background-size: auto 200% !important;
    }
  
    :root[tabsintitlebar]:not([sizemode=fullscreen]) #TabsToolbar:-moz-window-inactive {
      background-image: linear-gradient(transparent, InactiveCaption) !important;
    }
  }
}

@media (-moz-bool-pref: "r3dfox.caption.text.color") {
  #TabsToolbar {
    color: white !important;
    --toolbarbutton-icon-fill: currentColor !important;
  }
  :root {
    --lwt-text-color: white !important;
  }
  #main-menubar:not([lwtheme]) {
    color: white !important;
  }
}

@media (-moz-bool-pref: "r3dfox.force.transparency") {
  :root {
    --lwt-additional-images: none !important;
    --lwt-header-image: none !important;
  }

  #navigator-toolbox {
    background-color: transparent !important;
  }

  #TabsToolbar {
    background-color: transparent !important;
  }

  #titlebar {
    appearance: inherit !important;
    background: transparent !important;
    background-color: transparent !important;
    background-image: transparent !important;
  }
  
  :root[sizemode=maximized] {
    #titlebar:not([lwtheme]) {
      margin-top: 8px !important;
    }
  }
}

@media (-moz-bool-pref: "r3dfox.transparent.menubar") {
  #main-window #main-menubar {
    background: none !important;
  }
}

@media (-moz-bool-pref: "r3dfox.translucent.navbar") {
  @media (-moz-bool-pref: "r3dfox.aero.fog") {
    @media (-moz-platform: windows-win7), (-moz-platform: windows-win8) {
      @media (-moz-windows-default-theme), (-moz-windows-compositor) {
        #titlebar:not([lwtheme]) {
          appearance: auto !important;
        }
        #navigator-toolbox {
          @media (-moz-bool-pref: "r3dfox.less.aero.fog") {
            background-image: radial-gradient(ellipse at bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.5) 60%, transparent) !important;
          }
          @media not (-moz-bool-pref: "r3dfox.less.aero.fog") {
            background-image: radial-gradient(ellipse at bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.5) 85%, transparent) !important;
          }
        }
        :root[sizemode=maximized] {
          #titlebar:not([lwtheme]) {
            margin-top: 0px !important;
          }
        }
      }
    }
  }
}

/* Main defines */

@media (-moz-bool-pref: "r3dfox.customizations.enabled") {
  :root {
    --align-menu-icons: -2px 6px;
    --tab-first-last-inline-margin: calc(var(--tab-min-height) / 2);
    --tab-overflow-clip-margin: var(--tab-first-last-inline-margin);
    --tab-inset-clip-path: -4px calc(-1 * var(--tab-first-last-inline-margin)) 0px;
    --tab-scroll-animation-inline-margin: calc(-1 * var(--tab-first-last-inline-margin));
    --tab-scroll-animation-inline-padding: var(--tab-first-last-inline-margin);
    --tab-bg-block-margin: 0px;
    --tab-inline-padding: 0px;
    --tab-separator-offset: 0px;
    --arrowpanel-background: light-dark(rgba(255, 255, 255, 0.975), rgba(66, 65, 77, 0.975)) !important;
    --toolbar-field-focus-background-color: light-dark(rgba(255, 255, 255, 0.975), rgba(66, 65, 77, 0.975)) !important;
  }

  /* Tab counter at top because it's funny */
  
  #tabbrowser-tabs {
      counter-reset: TabCounter;
  }
  
  .tabbrowser-tab {
      counter-increment: TabCounter;
  }
  
  #tabbrowser-tabs ~ #alltabs-button::after {
      content: counter(TabCounter);
  }
  
  /* ---------------------------------------- Indents ---------------------------------------- */
  
  .titlebar-spacer {
      display: none !important;
  }

  :root:has(#toolbar-menubar[autohide="true"])[sizemode="normal"] {
    --drag-space: 15px;
/*    #TabsToolbar > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
      display: none !important;
    }*/
  }

  #TabsToolbar :is(.tabbrowser-tab, .toolbarbutton-1, separator, #personal-bookmarks, #search-container, .accessibility-indicator, .private-browsing-indicator, #private-browsing-indicator-with-label) {
      margin-top: var(--drag-space, 0px) !important;
  }
  
  #tabbrowser-arrowscrollbox {
      --margin-top: var(--drag-space, 0px) !important;
  }
  
  #scrollbutton-up,
  #scrollbutton-down,
  spacer[part="overflow-start-indicator"],
  spacer[part="overflow-end-indicator"] {
      margin-top: var(--margin-top, revert) !important;
  }
  
  #TabsToolbar .toolbarbutton-1 {
    padding-right: 8px !important;
  }
  
  :root:not([privatebrowsingmode], [firefoxviewhidden]) :is(toolbarbutton, toolbarpaletteitem) + #tabbrowser-tabs, :root[privatebrowsingmode]:not([firefoxviewhidden]) :is(toolbarbutton:not(#firefox-view-button), toolbarpaletteitem:not(#wrapper-firefox-view-button)) + #tabbrowser-tabs {
    border-inline-start: 0px solid !important;
    padding-inline-start: 0px !important;
    margin-inline-start: 0px !important;
  }
  
  #TabsToolbar-customization-target > :is(toolbarbutton, toolbaritem):first-child,
  #TabsToolbar-customization-target > toolbarpaletteitem:first-child > :is(toolbarbutton, toolbaritem) {
      margin-inline-start: calc(var(--toolbar-start-end-padding) - var(--toolbarbutton-outer-padding)) !important;
  }
  
  #TabsToolbar-customization-target > :is(toolbarbutton, toolbaritem):last-child,
  #TabsToolbar-customization-target > toolbarpaletteitem:last-child > :is(toolbarbutton, toolbaritem) {
      margin-inline-end: calc(var(--toolbar-start-end-padding) - var(--toolbarbutton-outer-padding)) !important;
  }
  
  #tabbrowser-tabs:not([overflow]) .tabbrowser-tab:nth-child(1 of .tabbrowser-tab:not([pinned], [hidden])) {
      margin-inline-start: 0px !important;
  }
  
  #tabbrowser-tabs:not([overflow]) .tabbrowser-tab:nth-child(1 of .tabbrowser-tab:not([hidden])),
  #tabbrowser-tabs[overflow] .tabbrowser-tab:nth-child(1 of .tabbrowser-tab:not([pinned], [hidden])),
  #tabbrowser-tabs[overflow][haspinnedtabs] {
      margin-inline-start: var(--tab-first-last-inline-margin) !important;
  }
  
  .tabbrowser-tab:nth-last-child(1 of .tabbrowser-tab:not([hidden])) {
      margin-inline-end: var(--tab-first-last-inline-margin) !important;
  }
  
  #tabs-newtab-button {
      margin-inline-start: calc(-1 * var(--tab-first-last-inline-margin) / 2) !important;
  }
  
  .toolbarbutton-1:has(+ #tabbrowser-tabs:not([overflow])),
  .toolbarbutton-1:has(+ #tabbrowser-tabs[overflow][haspinnedtabs]) {
      margin-inline-end: calc(-1 * var(--tab-first-last-inline-margin) / 2 + 1px) !important;
      z-index: 0 !important;
  }

  /* ---------------------------------------- Tabs ---------------------------------------- */
  
  :root[tabsintitlebar] #titlebar:-moz-window-inactive {
    opacity: 1 !important;
  }
  
  .tabbrowser-tab[visuallyselected] {
    color: var(--toolbar-color) !important;
  
    .tab-background {
      background-color: var(--toolbar-bgcolor) !important;
    }
  }

  :root {
      --tab-min-height: 32px !important;

    #nav-bar {
      height: 32px !important;
    }
  }

  :root[uidensity="compact"] {
      --tab-min-height: 24px !important;

    .tab-label-container {
      #tabbrowser-tabs:not([secondarytext-unsupported]) & {
        height: 2em !important;
      }
    }

    #nav-bar {
      height: 27px !important;
    }

    #urlbar-container {
      min-height: 20px !important; height: 28px !important;
    }
  }

  :root[uidensity="touch"] {
      --tab-min-height: 40px !important;
  }
  
  @media not (prefers-contrast) {
      .titlebar-buttonbox-container
      {
          align-items: flex-start !important;
      }
  
      .titlebar-button:not(.titlebar-close):hover
      {
          background-color: var(--toolbarbutton-hover-background) !important;
      }
  
      .titlebar-button:not(.titlebar-close):hover:active
      {
          background-color: var(--toolbarbutton-active-background) !important;
      }
  }
  
  .tabbrowser-tab {
      --tab-label-mask-size: 0px !important;
      overflow-x: clip !important;
      overflow-y: visible !important;
      overflow-clip-margin: var(--tab-overflow-clip-margin) !important;
      clip-path: inset(var(--tab-inset-clip-path)) !important;
      padding-inline: var(--tab-inline-padding) !important;
  
      &[visuallyselected]
      {
          position: relative;
          z-index: 2 !important;
          filter: var(--additional-outer-drop-shadow)
                  var(--outer-drop-shadow);
      }
  
      &:not([visuallyselected])
      {
          color: inherit !important;
  
          &:hover .tab-background
          {
              background-color: var(--toolbarbutton-hover-background) !important;
          }
  
          &[multiselected] .tab-background
          {
              background-color: var(--toolbarbutton-active-background) !important;
          }
      }
  
      .tab-background
      {
          mask-image: url("r3d_left_corner.svg"), url("r3d_center.svg"), url("r3d_right_corner.svg");
          mask-size: auto 100%, calc(100% - var(--tab-min-height) * 2) 100%, auto 100%;
          mask-position: left center, center center, right center;
          mask-repeat: no-repeat, no-repeat, no-repeat;
          box-shadow: none !important;
          outline: none !important;
          margin-block: var(--tab-bg-block-margin) !important;
          margin-inline: calc(-1 * (var(--tab-min-height) / 2)) !important;
          border-radius: 0px !important;
          pointer-events: none !important;
      }
  
      &[pinned] .tab-content
      {
          padding-inline: calc((var(--tab-min-height) - 16px) / 2 + var(--pinned-tabs-width-offset, 0px)) !important;
      }
  
      &:not([pinned]) .tab-content
      {
          padding-inline: 10px !important;
      }
  }

  #tabbrowser-tabs[movingtab] .tabbrowser-tab:not([visuallyselected]) {
      z-index: auto !important;
  }
  
  .tabbrowser-tab[pending] .tab-icon-image {
      filter: saturate(0) !important;
  }
  
  .tab-close-button {
      width: 16px !important;
      height: 16px !important;
      border-radius: 50% !important;
      padding: 2px !important;
      margin: 0px !important;
  }
  
  .tab-close-button:hover {
      background-color: var(--toolbarbutton-hover-background) !important;
  }
  
  .tab-close-button:hover:active {
      background-color: var(--toolbarbutton-active-background) !important;
  }
  
  /* -------------------- Selected Tab Indicator -------------------- */

  @media not (-moz-bool-pref: "r3dfox.colors.enabled") {
    :root {
      --lwt-tab-line-color: light-dark(var(--color-blue-50), var(--color-cyan-50)) !important;
      &[privatebrowsingmode=temporary] {
        --lwt-tab-line-color: #9400FF !important;
      }
    }
  }

  /* adds the little colored strip on top of the selected tab */
  .tab-background:is([selected], [multiselected]) {
    box-shadow: inset 0 2px 0 var(--lwt-tab-line-color) !important;
    border: 0 !important;
    outline: none !important;
  }
  
  /* special handling for mozilla containers */
  tab[class*="identity-color"] {
    background-image: linear-gradient(var(--identity-tab-color, white), var(--identity-tab-color, white));
    background-size: 100% 2px;
    background-position: bottom center;
    background-repeat: no-repeat;
    border: 0 !important;
    outline: none !important;
  }
  
  /* override the built in container colors */
  tab[class*="identity-color"][selected="true"]>.tab-stack>.tab-background>.tab-context-line {
    height: 0 !important;
  }
  
  /* replace with our own container border */
  tab[class*="identity-color"][selected="true"]>.tab-stack>.tab-background:is([selected], [multiselected]) {
    box-shadow: inset 0 2px var(--identity-tab-color, white) !important;
    background-image: linear-gradient(var(--identity-tab-color, white), var(--identity-tab-color, white));
    background-size: 100% 2px;
    background-position: bottom center;
    background-repeat: no-repeat;
    border: 0 !important;
    outline: none !important;
  }
}